kind: Environment
name: "preview"
type: ephemeral  # Dit moet ephemeral zijn voor preview environments
environmentVariables:
  DemoVarDefinedInBunnyshell: demo-value
urlHandle: preview-devops-freek
components:
  - name: mongodb
    kind: Service
    dockerCompose:
      image: 'mongo:latest'
      restart: unless-stopped
      volumes:
        - './data:/data/db'
    ports:
      - port: 27017
        name: mongo
        protocol: TCP

  - name: api
    kind: Service
    dockerCompose:
      environment:
        PORT: 12345
        MONGO_URL: 'mongodb://mongodb:27017'  # Gebruik de service naam 'mongodb'
        DB_NAME: myapp
      build:
        context: .
        dockerfile: Dockerfile.prod
      depends_on:
        - mongodb
      restart: unless-stopped
    ports:
      - port: 12345
        name: api
        protocol: TCP
        public: true

  - name: frontend
    kind: Service
    dockerCompose:
      build:
        context: ./frontend
        dockerfile: Dockerfile
      depends_on:
        - api
      restart: unless-stopped
    ports:
      - port: 80
        name: frontend
        protocol: TCP
        public: true